#!/usr/bin/env Rscript
files <- commandArgs(trailing = TRUE)

if (git2r::in_repository()) {
  git_status <- git2r::status(staged = FALSE)
  if (any(unlist(git_status) == ".lintr")) {
    stop("Unstaged changes to .lintr file. Stage the .lintr file or discard the changes to it. ", call. = FALSE)
  }
}

out <- lapply(files, function(path) {
  lints <- lintr::lint(path)
  if (length(lints) > 0) {
    stop(
      "File ", path, " is not lint free\n",
      "Run lintr::lint('", path, "') to check the lintr output.",
      call. = FALSE
    )
  }
})
